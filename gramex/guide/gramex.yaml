variables:
    GUIDE_ROOT: $YAMLURL

app:
  settings:
    login_url: /auth/google
    cookie_secret: COOKIE_NAME
    autoreload: False
    debug: False
    xsrf_cookies: False

import:
    subdirectories: '*/gramex.yaml'

url:
    welcome:
        pattern: /$YAMLURL/welcome
        handler: FileHandler
        kwargs:
            path: index.html
    final-config:
        pattern: /$YAMLURL/final-config
        handler: FunctionHandler
        kwargs:
            function: guide.config
            headers:
                Content-Type: text/yaml
    markdown:
        pattern: /$YAMLURL/(.*)
        handler: FileHandler
        kwargs:
            path: $YAMLPATH
            default_filename: README.md
            index: true
            transform:
                "*.md":
                    function: guide.markdown_template
                    args: [=content, =handler]
                    encoding: utf-8
                    headers:
                        Content-Type: text/html
    root-config:
        pattern: /$YAMLURL/root.gramex.yaml
        handler: FileHandler
        kwargs:
            path: $GRAMEXPATH/gramex.yaml
    guide-markdown:
        pattern: /$YAMLURL/(roadmap)
        handler: FileHandler
        kwargs:
            path: $YAMLPATH/*.md
            transform:
                "*.md":
                    function: guide.markdown_template
                    args: [=content, =handler]
                    encoding: utf-8
                    headers:
                        Content-Type: text/html

    # Static files are cached on the browser and on the serve
    static:
        pattern: /$YAMLURL/(.*.css)
        handler: FileHandler
        cache: true                                     # Cache on the server
        kwargs:
            path: $YAMLPATH/*
            headers:
                Cache-Control: public, max-age=300      # Cache on the browser for 5 minutes

    # /path.source shows the raw file as plain text
    source:
        priority: +1
        pattern: /$YAMLURL/(.*)\.source
        handler: FileHandler
        kwargs:
            path: $YAMLPATH
            Content-Type: text/plain

watch:
    markdown_template:
        paths: $YAMLPATH/markdown.template
        on_created: guide.load_markdown_template
        on_modified: guide.load_markdown_template
