{
  "$schema": "https://vega.github.io/schema/vega/v5.json",
  "width": 590,
  "height": 360,
  "padding": {
    "left": 5,
    "right": 5
  },
  "autosize": "fit",
  "signals": [
    {
      "name": "k",
      "value": 20,
      "bind": {
        "input": "range",
        "min": 3,
        "max": 50,
        "step": 1
      }
    },
    {
      "name": "operation",
      "value": "average",
      "bind": {
        "input": "select",
        "options": [
          "average",
          "median",
          "sum"
        ]
      }
    },
    {
      "name": "label",
      "value": {
        "average": "Average",
        "median": "Median",
        "sum": "Total"
      }
    }
  ],
  "title": {
    "text": {
      "signal": "'Top <%= data_mapper.column_1 %> by ' + label[operation] + ' <%= data_mapper.column_2 %>'"
    },
    "anchor": "start"
  },
  "data": [
    {
      "name": "directors",
      "url": "<%= dataset_url %>",
      "transform": [
        {
          "type": "filter",
          "expr": "datum['<%= data_mapper.column_1 %>'] != null && datum['<%= data_mapper.column_2 %>'] != null"
        },
        {
          "type": "aggregate",
          "groupby": [
            "<%= data_mapper.column_1 %>"
          ],
          "ops": [
            {
              "signal": "operation"
            }
          ],
          "fields": [
            "<%= data_mapper.column_2 %>"
          ],
          "as": [
            "<%= data_mapper.column_2 %>"
          ]
        },
        {
          "type": "window",
          "sort": {
            "field": "<%= data_mapper.column_2 %>",
            "order": "descending"
          },
          "ops": [
            "row_number"
          ],
          "as": [
            "rank"
          ]
        },
        {
          "type": "filter",
          "expr": "datum.rank <= k"
        }
      ]
    }
  ],
  "marks": [
    {
      "name": "Bars",
      "type": "rect",
      "from": {
        "data": "directors"
      },
      "encode": {
        "update": {
          "fill": {
            "value": "#506FA8"
          },
          "fillOpacity": {
            "value": 1
          },
          "x": {
            "scale": "x axis",
            "value": 0
          },
          "x2": {
            "scale": "x axis",
            "field": "<%= data_mapper.column_2 %>"
          },
          "y": {
            "scale": "y axis",
            "field": "<%= data_mapper.column_1 %>"
          },
          "height": {
            "scale": "y axis",
            "band": 1
          },
          "tooltip": {
            "signal": "datum"
          }
        }
      }
    }
  ],
  "scales": [
    {
      "name": "x axis",
      "type": "linear",
      "domain": {
        "data": "directors",
        "field": "<%= data_mapper.column_2 %>"
      },
      "range": "width",
      "nice": true
    },
    {
      "name": "y axis",
      "type": "band",
      "domain": {
        "data": "directors",
        "field": "<%= data_mapper.column_1 %>",
        "sort": {
          "op": "max",
          "field": "<%= data_mapper.column_2 %>",
          "order": "descending"
        }
      },
      "range": "height",
      "padding": 0.1
    }
  ],
  "axes": [
    {
      "scale": "x axis",
      "title": "<%= data_mapper.column_2 %>",
      "orient": "bottom",
      "tickCount": 5
    },
    {
      "scale": "y axis",
      "title": "<%= data_mapper.column_1 %>",
      "orient": "left"
    }
  ]
}